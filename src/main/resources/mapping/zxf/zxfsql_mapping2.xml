<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sy.demo.dao.zxf.ZXF_IDao2">
	<!-- 商家入驻user表修改 -->
	<update id="sjrz">
		UPDATE
		`user`
		SET
		<if test="us.userMoney!=null">
			`userMoney`=#{us.userMoney },
		</if>
		`userRealName` = #{us.userRealName },
		`country` =#{us.country },
		`provincialID` = #{us.provincialID },
		`cityID` =#{us.cityID },
		`countyID` = #{us.countyID },
		`adDetail`
		=#{us.adDetail },
		`merchantType` =#{us.merchantType },
		`firstServiceID` =
		#{us.firstServiceID },
		`secondServiceID`
		=#{us.secondServiceID },
		`firstServiceMoney` = 0,
		`secondServiceMoney` =
		0,
		`hospitalName`
		=#{us.hospitalName },
		`shopName` = #{us.shopName },
		`signature`
		=#{us.signature },
		`guaranteeMoney` = #{us.guaranteeMoney },
		`shopImg` =
		#{us.shopImg },
		`identityType` = #{us.identityType },
		`identityNumder` =
		#{us.identityNumder },
		`identityRealName`
		=#{us.identityRealName } ,
		`identityPositiveImg`
		=#{us.identityPositiveImg },
		`identityNegativeImg`
		=#{us.identityNegativeImg },
		`identityHandImg`
		=#{us.identityHandImg } ,
		`languageNameText` =#{us.languageNameText },
		`majorNameText`
		=#{us.majorNameText },
		`liveCityID` =#{us.liveCityID },
		`merchantEmail`
		=#{us.merchantEmail },
		`merchantPhone`
		=#{us.merchantPhone },
		`qq` =
		#{us.qq },
		`weChat` = #{us.weChat },
		`profession` =#{us.profession },
		`height` =#{us.height },
		`constellation` =#{us.constellation },
		`age`
		=#{us.age },
		`selfIntroduction` = #{us.selfIntroduction },
		`experience`
		=#{us.experience },
		`experienceStatus` =#{us.experienceStatus },
		`auditStatus` =1,
		`creditScore` = 300
		WHERE `userID` = #{us.userID }
	</update>
	<!-- 新增保证金记录 -->
	<insert id="addBand">
		INSERT INTO `bond` (
		`userID`,
		`bondType`,
		`goldCoin`,
		`submitTime`,
		`auditStatus`
		)
		VALUES
		(
		#{bd.userID },
		#{bd.bondType },
		#{bd.goldCoin },
		NOW(),
		1
		)
	</insert>
	<!-- 服务信息查询 -->
	<select id="queryServices" resultType="Services">
		SELECT
		*
		FROM
		`services`
		where `userID`=#{uid }
		<if test="auditStatus!=0">
			and `auditStatus` = #{auditStatus }
		</if>
		<if test="serviceTitle!=null">
			and (`serviceTitle`like '%${serviceTitle }%' OR
			`serviceFuTitle` LIKE '%${serviceTitle }%')
		</if>
	</select>
	<!-- 查询商家订单 -->
	<resultMap type="Ordersvo1" id="orderMapping">
		<association property="ser" column="serviceID"
			select="querybyser" />
		<association property="u" column="userID"
			select="querybyuser" />
	</resultMap>
	<select id="querybyser" resultType="services">
		SELECT * FROM services WHERE
		`serviceID` = #{0 }
	</select>
	<select id="querybyuser" resultType="user">
		SELECT * FROM user WHERE
		`userID` = #{0 }
	</select>
	<select id="queryOrders" resultMap="orderMapping">
		SELECT
		*
		FROM `orders`
		<where>
			<if test="oids!=null">
				orderID = #{oids }
			</if>
			<if test="oids==null">
				serviceID IN (SELECT serviceID FROM services WHERE userID=#{uid })
				<if test="oid!=null">
					and orderID like '%${oid }%'
				</if>
				<if test="stat!=0">
					and orderStatus = #{stat }
				</if>
			</if>
		</where>
	</select>
	<!-- 修改订单状态 -->
	<update id="ordersStatupdate">
		UPDATE
		`orders`
		SET
		`orderStatus` = #{stat }

		WHERE
		`orderID` = #{orderID }
	</update>

	<insert id="addservices">
		INSERT INTO `services` (
		`stid`,
		`userID`,
		`resourceID`,
		`serviceTitle`,
		`serviceFuTitle`,
		`downloadTitle`,
		`servicePrice`,
		`serviceCoverImg`,
		`serviceImgUrlOne`,
		`serviceImgUrlTwo`,
		`serviceImgUrlThree`,
		`serviceImgUrlFour`,
		`serviceCostTypeID`,
		`serviceIntro`,
		`serviceCity`,
		`country`,
		`serviceCostInclude`,
		`serviceStartDate`,
		`serviceEndDate`,
		`schoolRegion`,
		`schoolNameByCN`,
		`majoyNameByCN`,
		`schoolNameByROK`,
		`majoyNameByROK`,
		`goodAtMajoy`,
		`hospitalName`,
		`serviceHour`,
		`uploadDataUrl`,
		`releaseTime`,
		`browseNumber`,
		`weight`,
		`auditStatus`
		)
		VALUES
		(
		#{services.stid },
		#{services.userID },
		#{services.resourceID },
		#{services.serviceTitle },
		#{services.serviceFuTitle },
		#{services.downloadTitle },
		#{services.servicePrice },
		#{services.serviceCoverImg },
		#{services.serviceImgUrlOne },
		#{services.serviceImgUrlTwo },
		#{services.serviceImgUrlThree },
		#{services.serviceImgUrlFour },
		#{services.serviceCostTypeID },
		#{services.serviceIntro },
		#{services.serviceCity },
		#{services.country
		},
		#{services.serviceCostInclude },
		#{services.serviceStartDate,jdbcType=DATE },
		#{services.serviceEndDate,jdbcType=DATE },
		#{services.schoolRegion },
		#{services.schoolNameByCN },
		#{services.majoyNameByCN },
		#{services.schoolNameByROK },
		#{services.majoyNameByROK },
		#{services.goodAtMajoy },
		#{services.hospitalName },
		#{services.serviceHour },
		#{services.uploadDataUrl },
		NOW(),
		0,
		#{services.weight },
		1
		);
	</insert>

	<!-- 商家收到的退款查询 -->
	<select id="queryrefund" resultType="RefundListVo">
		SELECT
		*
		FROM
		`refund`
		WHERE
		`orderID` IN
		(SELECT
		orderID
		FROM `orders`
		WHERE serviceID IN (SELECT
		serviceID FROM
		services WHERE userID=#{uid
		}))
	</select>
	<select id="queryrefundbyid" resultType="RefundListVo">
		SELECT
		*
		FROM
		`refund`
		WHERE `refundID` = #{id }
	</select>

	<update id="ordersrefundstatusupdate">
		UPDATE `orders`
		SET
		`refundstatus` = #{refundstatus }
		WHERE
		`orderID` = #{orderID }
	</update>

	<update id="refundrefundstatusupdate">
		UPDATE
		`refund`
		SET
		`businessRemarks` =#{businessRemarks
		},
		`auditTime` = NOW(),
		`auditStatus` = #{auditStatus }
		WHERE `refundID`
		= #{refundID }
	</update>

	<update id="usermoneyupdate">
		UPDATE
		`user`
		SET
		<if test="jiajian==1">
			`userMoney` =`userMoney`+ #{money }
		</if>
		<if test="jiajian==2">
			`userMoney` =`userMoney` - #{money }
		</if>

		WHERE `userID`
		= #{uid };
	</update>
</mapper>